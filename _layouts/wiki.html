---
layout: default
---

<!-- This is your layout file, e.g., _layouts/hierarchy.html -->

{% assign hierarchy = {} %}

<!-- Step 1: Build the Nested Hierarchy -->
{% for post in site.posts %}
  {% assign current = hierarchy %}
  {% assign category = post.category %}

  <!-- Create the category if it doesn't exist -->
  {% if current[category] == nil %}
    {% assign current = current | merge: { category: {} } %}
  {% endif %}
  {% assign current = current[category] %}

  <!-- Build the tag hierarchy -->
  {% for tag in post.tags %}
    {% if current[tag] == nil %}
      {% assign current = current | merge: { tag: {} } %}
    {% endif %}
    {% assign current = current[tag] %}
  {% endfor %}

  <!-- Add post to the deepest level -->
  {% if current["posts"] == nil %}
    {% assign current = current | merge: { "posts": [] } %}
  {% endif %}
  {% assign current["posts"] = current["posts"] | push: post %}
{% endfor %}

<!-- Step 2: Render the Nested Hierarchy -->
<ul>
  {% for category, tags in hierarchy %}
    <li><strong>{{ category }}</strong>
      {{ render_tags(tags) }}
    </li>
  {% endfor %}
</ul>

<!-- Recursive Function to Render Tags -->
{% capture render_tags %}
{% macro render_tags(tags) %}
  <ul>
    {% for tag, value in tags %}
      {% if tag == "posts" %}
        <ul>
          {% for post in value %}
            <li><a href="{{ post.url }}">{{ post.title }}</a></li>
          {% endfor %}
        </ul>
      {% else %}
        <li>{{ tag }}
          {{ render_tags(value) }}
        </li>
      {% endif %}
    {% endfor %}
  </ul>
{% endmacro %}
{% endcapture %}

<!-- Inline Alternative for GitHub Pages (Replace Macro if Needed) -->
{% assign render_tags_inline = "" %}
{% capture render_tags_inline %}
  <ul>
    {% for tag, value in tags %}
      {% if tag == "posts" %}
        <ul>
          {% for post in value %}
            <li><a href="{{ post.url }}">{{ post.title }}</a></li>
          {% endfor %}
        </ul>
      {% else %}
        <li>{{ tag }}
          {{ render_tags_inline | replace: "tags", value }}
        </li>
      {% endif %}
    {% endfor %}
  </ul>
{% endcapture %}
