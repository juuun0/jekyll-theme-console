---
layout: default
---

{% assign hierarchy = {} %}

<!-- Step 1: Build the Nested Hierarchy -->
{% for post in site.posts %}
  {% assign current = hierarchy %}
  {% assign category = post.category %}

  <!-- Create the category if it doesn't exist -->
  {% if current[category] == nil %}
    {% assign current = current | merge: { category: {} } %}
  {% endif %}
  {% assign current = current[category] %}

  <!-- Build the tag hierarchy -->
  {% for tag in post.tags %}
    {% if current[tag] == nil %}
      {% assign current = current | merge: { tag: {} } %}
    {% endif %}
    {% assign current = current[tag] %}
  {% endfor %}

  <!-- Add post to the deepest level -->
  {% if current["posts"] == nil %}
    {% assign current = current | merge: { "posts": [] } %}
  {% endif %}
  {% assign current["posts"] = current["posts"] | push: post %}
{% endfor %}

<!-- Step 2: Recursive Rendering -->
<ul>
  {% for category, tags in hierarchy %}
    <li><strong>{{ category }}</strong>
      {{ render_tags(tags) }}
    </li>
  {% endfor %}
</ul>

<!-- Inline Recursive Function -->
{% assign render_tags = "" %}
{% capture render_tags %}
  <ul>
    {% for tag, value in tags %}
      {% if tag == "posts" %}
        <ul>
          {% for post in value %}
            <li><a href="{{ post.url }}">{{ post.title }}</a></li>
          {% endfor %}
        </ul>
      {% else %}
        <li>{{ tag }}
          <ul>
            {% for sub_tag, sub_value in value %}
              {% if sub_tag == "posts" %}
                <ul>
                  {% for post in sub_value %}
                    <li><a href="{{ post.url }}">{{ post.title }}</a></li>
                  {% endfor %}
                </ul>
              {% else %}
                <li>{{ sub_tag }}</li>
              {% endif %}
            {% endfor %}
          </ul>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
{% endcapture %}
